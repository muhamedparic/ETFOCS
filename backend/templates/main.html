
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ETF Online Competition System - Log in!</title>
      
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="{{ url_for('static', filename='jumbotron.css') }}" rel="stylesheet">
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">ETF Online Competition System</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <form class="navbar-form navbar-right"  >
            <div class="form-group">
              <input type="text" name="username" id="textbox" value="" placeholder="Username" class="form-control">
            </div>
            <div class="form-group">
              <input type="password" name="password" id="textbox2" value="" placeholder="Password" class="form-control" >
            </div>
             <button type="submit" onclick="PrimiJSon();return false;" class="btn btn-success">Log in</button>
          </form>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <div class="jumbotron">
      <div class="container">
        <h1>Hello!</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>
        <p><a class="btn btn-primary btn-lg" href="#" role="button">Saznaj više &raquo;</a></p>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h2>Naslov 1</h2>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <p><a class="btn btn-default" href="#" role="button">Detalji &raquo;</a></p>
        </div>
        <div class="col-md-4">
          <h2>Naslov 2</h2>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <p><a class="btn btn-default" href="#" role="button">Detalji &raquo;</a></p>
       </div>
        <div class="col-md-4">
          <h2>Naslov 3</h2>
          <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
          <p><a class="btn btn-default" href="#" role="button">Detalji &raquo;</a></p>
        </div>
      </div>

      <hr>

      <footer>
        <p>&copy; 2017 BP TIM X</p>
      </footer>
    </div> <!-- /container -->






<script>
function validate(){
localStorage.clear();
    var textbox = document.getElementById("textbox");
    var TCode = document.getElementById('textbox').value;
var textbox2 = document.getElementById("textbox2");
var TCode2 = document.getElementById("textbox2").value;
    if((textbox2.value.length <= 25 && textbox2.value.length >= 5)&&(textbox.value.length <= 25 && textbox.value.length >= 5)&&((! /[^a-zA-Z0-9\-\/]/.test( TCode ) ) ))
    {
       


alert("gotovo");

return true;
    }
    else{
        alert("Username i password treba biti izmedju 5 i 25 karaktera,i username ne smije imati specijalne znakove")
return false;
        }

}


function PrimiJSon()
{    var textbox = document.getElementById("textbox");
    var TCode = document.getElementById('textbox').value;
var textbox2 = document.getElementById("textbox2");
var TCode2 = document.getElementById("textbox2").value;
  if((textbox2.value.length <= 25 && textbox2.value.length >= 5)&&(textbox.value.length <= 25 && textbox.value.length >= 5)&&((! /[^a-zA-Z0-9\-\/]/.test( TCode ) ) ))
    {
var http = new XMLHttpRequest();
var url = "/api/login";
var params = "username="+TCode+"&password="+TCode2;
http.open("POST", url, true);
       http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http.onreadystatechange = function() {//Call a function when the state changes.
    if(http.readyState == 4 && http.status == 200) {
//Uzimanje JSona

            
                var myObj = JSON.parse(this.responseText);

                var a = myObj.success;
                




                



if(a)
{b = myObj.token;
alert(b.hash);


var c=ProvjeriToken(a,b);
alert(c);
localStorage.setItem("token",b);
setTimeout(function() {window.location = "/home" });
}
else
{alert("Pogresna sifra ili username ili oboje");
}




    }
}
http.send(params);


   }
    else{
        alert("Username i password treba biti izmedju 5 i 25 karaktera,i username ne smije imati specijalne znakove")
return false;
        }
}





function ProvjeriToken(a,b)
{var http2 = new XMLHttpRequest();
var url2 = "/api/token_valid";
alert(JSON.stringify(b));
var params2 = "token="+ JSON.stringify(b);
alert(b.hash);
alert(params2);
http2.open("POST", url2, true);
http2.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http2.onreadystatechange = function() {//Call a function when the state changes.
    if(http.readyState == 4 && http.status == 200) {

            var vrijednost =this.responseText;
alert(vrijednost);
            if(vrijednost)return true;
//ako token nije dobar vraca se false
return false;
          


    }
}
http2.send(params2);







}
</script>






  </body>
</html>
